найвідвідуваніші частини додатку
```
customEvents
| where user_AccountId == "e19dfed0-becd-4bbe-8659-eb0a9023e537" and name contains "Visit"
| summarize count() by name
```

| Page                          | Visits | apis                                                                                                                                           | MedianDuration                            |
| ----------------------------- | ------ | ---------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------- |
| PersonProfile.Visit           | 633    | 1. [[activityfeed_query]] <br>2. /api/v1.0/contacts/query<br>3. /api/v1.0/todos/preview/query<br>4./api/Engagement/GetTrackerEmailInteractions | 1. 251ms<br>2.<br>3. 1043ms<br>4. 318.5ms |
| Sequence.Visit                | 488    | /api/v1.0/campaig'ns/d762470d-8daa-4eaa-bac7-ed0122162d9c                                                                                      | 974                                       |
| Sequence.Steps.Visit          | 458    |                                                                                                                                                |                                           |
| Planner.Visit                 | 360    |                                                                                                                                                |                                           |
| Sequences.Visit               | 287    |                                                                                                                                                |                                           |
| Sequence.Recipients.Visit     | 263    |                                                                                                                                                |                                           |
| Team.Visit                    | 158    |                                                                                                                                                |                                           |
| SignalsFeed.Visit             | 80     |                                                                                                                                                |                                           |
| Audience.Visit                | 56     |                                                                                                                                                |                                           |
| Employee.Visit                | 33     |                                                                                                                                                |                                           |
| Opportunities.Visit           | 30     |                                                                                                                                                |                                           |
| Opportunity.Visit             | 17     |                                                                                                                                                |                                           |
| Sequence.Statistics.Visit     | 14     |                                                                                                                                                |                                           |
| Templates.Visit               | 4      |                                                                                                                                                |                                           |
| Accounts.Visit                | 3      |                                                                                                                                                |                                           |
| Settings.Automation.Visit     | 2      |                                                                                                                                                |                                           |
| SequenceRequiredActions.Visit | 2      |                                                                                                                                                |                                           |
| Settings.Signals.Visit        | 1      |                                                                                                                                                |                                           |
|                               |        |                                                                                                                                                |                                           |

### PersonProfile.Visit

| step                            | api                                                                                       | percentile_duration_50 | percentile_duration_70 | blocks the next step? | query                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | notes                                                                    | actions                                   |
| ------------------------------- | ----------------------------------------------------------------------------------------- | ---------------------- | ---------------------- | --------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------ | ----------------------------------------- |
| load contact                    | api/v1.0/contacts/:id                                                                     | 1146                   | 857.75                 | true                  | [link](https://portal.azure.com/#@d5564c63-fe88-47f5-bb3a-e857c6a12ad0/blade/Microsoft_OperationsManagementSuite_Workspace/Logs.ReactView/resourceId/%2Fsubscriptions%2Fa112f56e-a5f0-489a-845c-d3cb60827d85%2FresourceGroups%2FRG-Shared-Prod-Revenuegrid%2Fproviders%2Fmicrosoft.insights%2Fcomponents%2FRG-Shared-Prod-Revenuegrid/source/LogsBlade.AnalyticsShareLinkToQuery/q/H4sIAAAAAAAAAw3NSw6CMBQF0LmreGGkiZUigjIg0aFrEGMe7UWaSCH9qPGzdz0bOBoTrIZVBn72oUcPB4oe7nJQaow2HDXVNSXIKt1BS9FCabFpW4hdWVQCreRKrnMU%252BTYhtposD6CBg%252BrhyeGKJ%252B0Tnkx6z5qVTNVoA6vg0xOLToqqEed3Xn6Tf%252B7jMLAzL9AEp2CDuWGuo%252BNgRrukQi5%252BFvIGyK4AAAA%253D/timespan/2024-10-01T09%3A21%3A17.000Z%2F2024-12-03T09%3A21%3A17.000Z/limit/M) |                                                                          | проговорити з костею чого так довго       |
| Feed/create filters             | /api/v1.0/contacts/activityfeed/query                                                     | 251                    | 363                    | true                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | для побудови фільтрів сіквенсу запит виконується в циклі батчами по 50шт | проговорити з костею<br>завести тікет<br> |
| Feed/load main data/todos       | /api/v1.0/todos/preview/query                                                             | 1035                   | 1596                   | no                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |                                                                          |                                           |
| Feed/load main data/interaction | 1./api/Engagement/GetTrackerEmailInteractions<br>2. /api/v1.0/contacts/activityfeed/query | 318<br>251<br>         | 402<br>363             | no                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |                                                                          |                                           |
|                                 |                                                                                           |                        |                        |                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |                                                                          |                                           |

### Sequences.Visit
| step           | api                                                                                              | percentile_duration_50 | percentile_duration_70 | blocking? | query | notes | actions |
| -------------- | ------------------------------------------------------------------------------------------------ | ---------------------- | ---------------------- | --------- | ----- | ----- | ------- |
| load settings  | /api/v1.0/setting                                                                                |                        |                        | yes       |       |       |         |
|                | api/acl/48bc4cf5-cfdd-4167-9c18-70ecddb75941/effective/user/48bc4cf5-cfdd-4167-9c18-70ecddb75941 |                        |                        |           |       |       |         |
| load sequences |                                                                                                  |                        |                        |           |       |       |         |
|                |                                                                                                  |                        |                        |           |       |       |         |
|                |                                                                                                  |                        |                        |           |       |       |         |
| total          |                                                                                                  | 1243                   | 1603                   |           |       |       |         |

### Sequence.Visit

| step          | api                                                      | percentile_duration_50 | percentile_duration_70 | blocking? | query | notes | actions |
| ------------- | -------------------------------------------------------- | ---------------------- | ---------------------- | --------- | ----- | ----- | ------- |
| load sequence | /api/v1.0/campaigns/d762470d-8daa-4eaa-bac7-ed0122162d9c | 974                    | 1645                   | no        |       |       |         |

### Sequence.Steps.Visit
| step                | api                                                                  | percentile_duration_50 | percentile_duration_70 | blocks the next step? | query | notes | actions                                                                        |
| ------------------- | -------------------------------------------------------------------- | ---------------------- | ---------------------- | --------------------- | ----- | ----- | ------------------------------------------------------------------------------ |
| load sequence       | /api/v1.0/campaigns/d762470d-8daa-4eaa-bac7-ed0122162d9c             | 974                    | 1645                   | no                    |       |       | додати перформанс метрику                                                      |
| load  settings      | /api/v1.0/users/e6788fde-0adf-4965-8955-a2fe9b78a59b/settings        | 192<br><br>            | 269.25                 | no                    |       |       |                                                                                |
| load  steps         | api/v1.0/campaigns/d762470d-8daa-4eaa-bac7-ed0122162d9c/steps        | 388                    | 554                    | no                    |       |       | степи можуть не чекати сатистику?                                              |
| lead step stats     | /api/v1.0/campaigns/d762470d-8daa-4eaa-bac7-ed0122162d9c/steps/stats | 455<br><br>            | 715                    | no                    |       |       |                                                                                |
| load sequence stats | /api/v1.0/campaigns/d762470d-8daa-4eaa-bac7-ed0122162d9c/stats       | 311.3125               | 442.25                 | no                    |       |       | степам не варто чакати статистику всього сіквенса, підвантажувати ЇЇ незалжно? |
|                     |                                                                      |                        |                        |                       |       |       |                                                                                |

### Planner.Visit

| step              | api                                                          | percentile_duration_50 | percentile_duration_70 | blocks the next step? | query | notes | actions                                 |
| ----------------- | ------------------------------------------------------------ | ---------------------- | ---------------------- | --------------------- | ----- | ----- | --------------------------------------- |
| load current user | /api/v1.0/users/me                                           | 373<br><br>            | 616                    | yes                   |       |       | запитати в Кості чи можна його кешувати |
| load acl          | `api/security/acl/${currentUserId}/effective/user/${userId}` | 346<br><br>            | 485                    | yes                   |       |       | кешуавти                                |
| load inbox stats  | /v1.0/todos/count/query                                      | 382                    | 548                    | yes                   |       |       | цей запит не мав би блокувати наступний |
| load todo preview | api/v1.0/todos/preview/query                                 | 1025                   | 1588                   |                       |       |       |                                         |
| total             |                                                              | 2889                   | 3002                   |                       |       |       |                                         |
перенести фіча прапорці в клейми


|                                                                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                   |                           |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------- |
| проблема                                                                                                                                                                                                                                                                                                                                                          | рішення                                                                                                                                                                                                                      | що отримаємо                                                                                                                                                                                                                                                      | скільки це буде коштувати |
| від завантаження html до виконання першого запиту проходить досить багато часу:<br><br>- Віджети перший запуск: 3.5с<br>- Віджети другий запуск: 1c<br>- Повний UI перший запуск: 5с<br>- Повний UI другий запуск:  1.5с<br><br>цей час йде на:<br><br>- завантаження бандлу при холодному старті (js файлу)<br>- парсинг js<br>- компіляція js<br>- виконання js | рішення це зменшити розмір бандлу, цього можна досягти поділивши його на логічні частини які будуть підвантажуватись за потреби, в загальному розділення виглядатиме як:<br><br>- common application code<br>- specific code | при розділенні можна буде очікувати 30-50% покращення часу<br><br>- Віджети перший запуск: 3.5с **(2.8 - 1.7)**<br>- Віджети другий запуск: 1c **(0.7 - 0.5)**<br>- Повний UI перший запуск: 5с **(4 - 2.5s)**<br>- Повний UI другий запуск:  1.5с **(1.2-0.75)** | ~1w                       |
| будь який запит за корисними данними чекає на фіча прапорці у вигляді синхрових сеттінгів, оскільки потрібно зрозуміти чи можна йти на сервіс за даними                                                                                                                                                                                                           | 1.  перенести фіча прапорці в клейми токену<br>2. кешувати сеттінги в сховище браузеру                                                                                                                                       | пришвидшемо відкриття будь-якої сторінки чи віджету на <br><br>percentile(duration, 50) - 406ms<br><br>percentile(duration, 70) - 521ms                                                                                                                           | 1. ~0.5d<br>2. ~1 - 1.5d  |
| кожену нову сессію заватажуються acl та плани, хоча вони змінюються не часто                                                                                                                                                                                                                                                                                      | кешувати на рівні http cache                                                                                                                                                                                                 | пришвидшемо відкриття сторінок де потрібен acl на<br><br>percentile(duration, 50) - 408ms<br><br>percentile(duration, 70) - 590ms                                                                                                                                 |                           |
| кожну нову сессію вантажаться current юзерів від різних сервісів, як мінімум синхровий                                                                                                                                                                                                                                                                            | кешувати в стораджі браузеру                                                                                                                                                                                                 | пришвидшемо відкриття сторінок де потрібен поточний юзер на<br>percentile(duration, 50) - 452<br>percentile(duration, 70) 597                                                                                                                                     |                           |
| відсутність віртуалізації в актівіті фід, відповідно наразі потрібно завантажити весь фід перед тим як показати юзеру корисну інформацію, але при цьому можна робити це підвантаження                                                                                                                                                                             | Змінити леяют там таким чином, щоб цей фід виглядав як список одного з елементами одного розміру, тоді можна буде додати віртуалізацію та підвантаження на скролі                                                            | зможемо пришвидшити завантаження актівіті фіда на<br><br>percentile(duration, 50 - 254<br>percentile(duration, 70 - 440                                                                                                                                           |                           |
| для побудови фільтрів по сіквенсу в activityfeed, запит на отримання activityfeed  виконується в блокуйочому циклі батчами по 50шт                                                                                                                                                                                                                                | 1. нове апі для отримання списку сіквенсів, які фігурують у фіді                                                                                                                                                             |                                                                                                                                                                                                                                                                   |                           |
|                                                                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                   |                           |


|                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                               |                                                                                                                                                                                                                                                                           |                          |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------ |
| Problem                                                                                                                                                                                                                                                                                                                                                            | Solution                                                                                                                                                                      | Expected Outcome                                                                                                                                                                                                                                                          | Cost                     |
| From loading HTML to executing the first request takes a significant amount of time:<br><br>- Widgets first launch: 3.5s<br>- Widgets second launch: 1s<br>- Full UI first launch: 5s<br>- Full UI second launch: 1.5s<br><br>This time is spent on:<br><br>- Loading the bundle during a cold start (JS file)<br>- Parsing JS<br>- Compiling JS<br>- Executing JS | Reduce bundle size by splitting it into logical chunks that can be loaded on demand. The split would generally look like:<br><br>- Common application code<br>- Specific code | By splitting the bundle, we can expect a 30-50% improvement in load times:<br><br>- Widgets first launch: 3.5s **(2.8 - 1.7)**<br>- Widgets second launch: 1s **(0.7 - 0.5)**<br>- Full UI first launch: 5s **(4 - 2.5)**<br>- Full UI second launch: 1.5s **(1.2-0.75)** | ~1w                      |
| Any request for useful data waits for feature flags in the form of sync settings to determine if it's permissible to query the service                                                                                                                                                                                                                             | 1. Move feature flags to token claims<br>2. Cache settings in browser storage                                                                                                 | Accelerate the opening of any page or widget by:<br><br>percentile(duration, 50) - 406ms<br><br>percentile(duration, 70) - 521ms                                                                                                                                          | 1. ~0.5d<br>2. ~1 - 1.5d |
| ACL is loaded in each new session, although they rarely change                                                                                                                                                                                                                                                                                                     | Cache at the HTTP cache level                                                                                                                                                 | Accelerate the opening of pages requiring ACL by:<br><br>percentile(duration, 50) - 408ms<br><br>percentile(duration, 70) - 590ms                                                                                                                                         |                          |
| Current users are fetched from various services in every new session, often synchronously                                                                                                                                                                                                                                                                          | Cache in browser storage                                                                                                                                                      | Accelerate the opening of pages requiring the current user by:<br>percentile(duration, 50) - 452ms<br>percentile(duration, 70) - 597ms                                                                                                                                    |                          |
| No virtualization in the activity feed means the entire feed must be loaded before showing useful information to the user, although this could be done on demand                                                                                                                                                                                                   | Change the layout so that the feed appears as a list with uniform-sized elements. This would allow virtualization and lazy loading on scroll                                  | Accelerate the loading of the activity feed by:<br><br>percentile(duration, 50) - 254ms<br>percentile(duration, 70) - 440ms                                                                                                                                               |                          |
| To build sequence filters in the activity feed, the request to fetch the activity feed is executed in a blocking loop, processing batches of 50                                                                                                                                                                                                                    | 1. Develop a new API to fetch the list of sequences appearing in the feed                                                                                                     |                                                                                                                                                                                                                                                                           |                          |
|                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                               |                                                                                                                                                                                                                                                                           |                          |
|                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                               |                                                                                                                                                                                                                                                                           |                          |


![[4.b0c36bf5a597e9b9f0ad.js]]

![[4.b0c36bf5a597e9b9f0ad.js.LICENSE.txt]]

![[80.58e118ff16ae81006c5e.js]]

![[172.1541f64a1ea4102b1522.js]]

![[236.21e2fee51ce8413ba328.js]]

![[276.7092fc6656298e5cc84b.js]]

![[284.421d96edb9c62390794d.js]]

![[324.8f064910fb7cbf78d2c9.js]]

![[436.0c536722aac8a366c1b7.js]]

![[768.7ba4721fec293580b278.js]]

![[768.7ba4721fec293580b278.js.LICENSE.txt]]

![[784.3eac2c435a8a6fb88d5a.js]]

![[820.3660d27540431af47aab.js]]

![[880.ad473f1ea192af481d7a.js]]

![[ForecastFunnelChartReport.e2fccc993b6384571db8.js]]

![[ForecastReport.1d1cd484976d4563a56b.js]]

![[index.tsx.4edcabe7b230c347b9bb.js]]

![[index.tsx.4edcabe7b230c347b9bb.js.LICENSE.txt]]

![[People.614f642fbe0aa5bc6a0f.js]]

![[redirect.tsx.9c436b1c2b6e0e5e9d1f.js]]

![[redirect.tsx.9c436b1c2b6e0e5e9d1f.js.LICENSE.txt]]

![[RevenueActivityReport.7bbf52b3b792a5a11c76.js]]

![[SequenceProductivity.4167e9381249cde9f273.js]]

![[SequenceRequiredActions.11c829e367ff2096dbfc.js]]

![[Settings.7aae3958e7fc160f65c0.js]]

![[sharedWorkerNotifier.js]]

![[TeamList.d504665824a78e44f673.js]]

![[Templates.dc975ee9877337197e11.js]]

![[unsubscribe.tsx.3404671a210ebef083d2.js]]

![[unsubscribe.tsx.3404671a210ebef083d2.js.LICENSE.txt]]

![[WaterfallReport.78d8683d963b589e4689.js]]

![[widgets.tsx.392f74070495a1dc65c9.js]]

![[widgets.tsx.392f74070495a1dc65c9.js.LICENSE.txt]]