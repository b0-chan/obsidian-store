
OAuth2 — це протокол авторизації, який дозволяє одному додатку отримати обмежений доступ до ресурсів користувача на іншому сервері без розкриття пароля користувача. Він часто використовується для надання доступу до ресурсів третьої сторони, таких як API, безпосередньо від імені користувача.

#### Основні принципи OAuth2

1. **Ролі учасників**:
    
    - **Resource Owner (Власник ресурсу)**: Це користувач, який надає доступ до своїх ресурсів.
    - **Client (Клієнт)**: Це додаток, який хоче отримати доступ до ресурсу.
    - **Authorization Server (Сервер авторизації)**: Сервер, який відповідає за автентифікацію користувача та видачу токенів доступу.
    - **Resource Server (Сервер ресурсу)**: Сервер, на якому розміщено ресурс користувача (наприклад, API сервісу, як-от Google Drive або Facebook).
2. **Токени**:
    
    - **Access Token**: Токен доступу, який дозволяє клієнту доступ до ресурсів на сервері ресурсу. Зазвичай має обмежений час дії.
    - **Refresh Token**: Токен оновлення, який дозволяє отримати новий токен доступу без необхідності повторної автентифікації користувача.
3. **Типи авторизації в OAuth2**:
    
    - **Authorization Code**: Використовується для серверних додатків. Клієнт отримує код авторизації, який обмінюється на токен доступу.
    - **Implicit Flow**: Підходить для клієнтських додатків (наприклад, односторінкових додатків). Токен доступу передається безпосередньо, але має певні ризики з безпеки.
    - **Client Credentials**: Використовується для доступу до ресурсів, які не пов’язані з користувачем. Підходить для серверних додатків.
    - **Resource Owner Password Credentials**: Клієнт запитує ім’я користувача та пароль безпосередньо для отримання токена доступу. Використовується лише в додатках, яким користувач може повністю довіряти.

#### Як працює OAuth2

1. Клієнт надсилає запит авторизації до сервера авторизації.
2. Сервер авторизації автентифікує користувача та повертає код авторизації (в **Authorization Code Flow**) або токен доступу (в **Implicit Flow**).
3. Клієнт отримує код або токен і використовує його для доступу до ресурсів на сервері ресурсу.
4. Якщо токен доступу закінчився, клієнт може використати refresh token для отримання нового токена доступу.


#### Cхема
- **Користувач** ➔ **Клієнт** (Ваш додаток): Користувач хоче увійти в додаток і натискає на кнопку, наприклад, "Увійти за допомогою Google".
    
- **Клієнт** ➔ **Authorization Server** (Сервер авторизації): Клієнт перенаправляє користувача на сервер авторизації з запитом на авторизацію. Запит включає `client_id` (ідентифікатор клієнта), `redirect_uri` (URL, куди сервер має перенаправити користувача після авторизації), `scope` (обсяг доступу), і `response_type=code` (показує, що очікується код авторизації).
    
- **Authorization Server** ➔ **Користувач**: Сервер авторизації автентифікує користувача (наприклад, запитує вхід в обліковий запис Google) і запитує підтвердження дозволів, зазначених у scope.
    
- **Користувач** ➔ **Authorization Server**: Користувач підтверджує дозвіл.
    
- **Authorization Server** ➔ **Клієнт**: Сервер авторизації перенаправляє користувача назад до клієнта за допомогою `redirect_uri` і передає `authorization_code` (код авторизації) як параметр в URL.
    
- **Клієнт** ➔ **Authorization Server**: Клієнт використовує отриманий `authorization_code` і надсилає запит на сервер авторизації для обміну коду на `access_token` (токен доступу) та, за потреби, `refresh_token`. Запит включає `client_id`, `client_secret` (секретний ключ клієнта), `redirect_uri`, і `grant_type=authorization_code`.
    
- **Authorization Server** ➔ **Клієнт**: Сервер авторизації перевіряє дані клієнта і повертає `access_token` (токен доступу) і, за потреби, `refresh_token`.
    
- **Клієнт** ➔ **Resource Server** (Сервер ресурсу): Клієнт тепер може використовувати `access_token` у запитах до сервера ресурсу, додаючи його до заголовка запиту (`Authorization: Bearer access_token`).
    
- **Resource Server** ➔ **Клієнт**: Сервер ресурсу перевіряє `access_token` і повертає запитувані дані, якщо токен дійсний.


   #### Приклад:

```
1.  Користувач            ----(натискає "Увійти")---->       Клієнт

2.  Клієнт                 ----(Запит авторизації)---->       Сервер авторизації

3.  Сервер авторизації     ----(Запит на вхід/дозвіл)---->    Користувач

4.  Користувач             ----(Підтвердження)---->          Сервер авторизації

5.  Сервер авторизації     ----(Код авторизації)---->        Клієнт

6.  Клієнт                 ----(Запит на токен доступу)---->  Сервер авторизації

7.  Сервер авторизації     ----(Токен доступу)---->          Клієнт

8.  Клієнт                 ----(Запит до ресурсу)---->       Сервер ресурсу

9.  Сервер ресурсу         ----(Дані ресурсу)---->           Клієнт

```